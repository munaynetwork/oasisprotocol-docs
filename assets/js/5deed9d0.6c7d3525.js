"use strict";(self.webpackChunkdocs_oasis_dev=self.webpackChunkdocs_oasis_dev||[]).push([[2052],{3905:function(e,n,t){t.d(n,{Zo:function(){return l},kt:function(){return h}});var r=t(7294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,r,o=function(e,n){if(null==e)return{};var t,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)t=a[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var u=r.createContext({}),d=function(e){var n=r.useContext(u),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},l=function(e){var n=d(e.components);return r.createElement(u.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},p=r.forwardRef((function(e,n){var t=e.components,o=e.mdxType,a=e.originalType,u=e.parentName,l=s(e,["components","mdxType","originalType","parentName"]),p=d(t),h=o,m=p["".concat(u,".").concat(h)]||p[h]||c[h]||a;return t?r.createElement(m,i(i({ref:n},l),{},{components:t})):r.createElement(m,i({ref:n},l))}));function h(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var a=t.length,i=new Array(a);i[0]=p;var s={};for(var u in n)hasOwnProperty.call(n,u)&&(s[u]=n[u]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var d=2;d<a;d++)i[d]=t[d];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}p.displayName="MDXCreateElement"},9728:function(e,n,t){t.r(n),t.d(n,{assets:function(){return l},contentTitle:function(){return u},default:function(){return h},frontMatter:function(){return s},metadata:function(){return d},toc:function(){return c}});var r=t(7462),o=t(3366),a=(t(7294),t(3905)),i=["components"],s={},u="Shutting Down a Node",d={unversionedId:"run-a-node/maintenance-guides/shutting-down-a-node",id:"run-a-node/maintenance-guides/shutting-down-a-node",title:"Shutting Down a Node",description:"When a node registers for an epoch, it is committing to being available",source:"@site/docs/general/run-a-node/maintenance-guides/shutting-down-a-node.md",sourceDirName:"run-a-node/maintenance-guides",slug:"/run-a-node/maintenance-guides/shutting-down-a-node",permalink:"/general/run-a-node/maintenance-guides/shutting-down-a-node",draft:!1,editUrl:"https://github.com/oasisprotocol/docs.oasis.dev/edit/main/docs/general/run-a-node/maintenance-guides/shutting-down-a-node.md",tags:[],version:"current",lastUpdatedAt:1656660481,formattedLastUpdatedAt:"7/1/2022",frontMatter:{},sidebar:"docs",previous:{title:"Refreshing Node Certificates",permalink:"/general/run-a-node/maintenance-guides/refreshing-certificates"},next:{title:"Node Troubleshooting",permalink:"/general/run-a-node/troubleshooting"}},l={},c=[{value:"Restarting a Shutdown Node",id:"restarting-a-shutdown-node",level:2}],p={toc:c};function h(e){var n=e.components,t=(0,o.Z)(e,i);return(0,a.kt)("wrapper",(0,r.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"shutting-down-a-node"},"Shutting Down a Node"),(0,a.kt)("p",null,"When a node registers for an epoch, it is committing to being available\nto service requests for the entire epoch.  Due to this availability\ncommitment, validator and non-client paratime nodes must be shutdown\ngracefully to avoid network disruption."),(0,a.kt)("p",null,"The graceful shutdown process involves the following steps:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Halt the automatic re-registration."),(0,a.kt)("li",{parentName:"ol"},"Wait for the node's existing registration to expire."),(0,a.kt)("li",{parentName:"ol"},"Terminate the node binary.")),(0,a.kt)("p",null,"To have the node gracefully shutdown, run:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"# Issue a graceful shutdown request.\noasis-node control shutdown\n\n# Issue a graceful shutdown request, and block until the node terminates.\n# Note: This can take up to a full epoch to complete.\noasis-node control shutdown \\\n  --wait\n")),(0,a.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,a.kt)("div",{parentName:"div",className:"admonition-heading"},(0,a.kt)("h5",{parentName:"div"},(0,a.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,a.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,a.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,a.kt)("div",{parentName:"div",className:"admonition-content"},(0,a.kt)("p",{parentName:"div"},"Failure to gracefully shutdown the node may result in the node being\nfrozen (and potentially stake being slashed) due to the node being\nunavailable to service requests in an epoch that it is registered."))),(0,a.kt)("h2",{id:"restarting-a-shutdown-node"},"Restarting a Shutdown Node"),(0,a.kt)("p",null,"To prevent restart loops causes by service managers, and to ensure\nthat the node will shutdown when requested, the node will persist\na flag indicating that a shutdown is in progress."),(0,a.kt)("p",null,"Oasis nodes prior to 22.0.3 will require that once a node is gracefully\nshutdown, the next time it is launched, the\n",(0,a.kt)("inlineCode",{parentName:"p"},"--worker.registration.force_register")," command line argument or equivalent\nconfig option be passed to the node the next time the node is started,\nor the node will shutdown immediately."),(0,a.kt)("p",null,"This behavior has been changed in newer revisions of the software such\nthat the flag should no longer be required."))}h.isMDXComponent=!0}}]);