"use strict";(self.webpackChunkdocs_oasis_dev=self.webpackChunkdocs_oasis_dev||[]).push([[1328],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return m}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),u=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=u(e.components);return a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),c=u(n),m=r,h=c["".concat(l,".").concat(m)]||c[m]||d[m]||i;return n?a.createElement(h,o(o({ref:t},p),{},{components:n})):a.createElement(h,o({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=c;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,o[1]=s;for(var u=2;u<i;u++)o[u]=n[u];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},628:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return l},default:function(){return m},frontMatter:function(){return s},metadata:function(){return u},toc:function(){return d}});var a=n(7462),r=n(3366),i=(n(7294),n(3905)),o=["components"],s={},l="Reproducibility",u={unversionedId:"runtime/reproducibility",id:"runtime/reproducibility",title:"Reproducibility",description:"If you wish to build paratime binaries yourself, you can use the",source:"@site/external/oasis-sdk/docs/runtime/reproducibility.md",sourceDirName:"runtime",slug:"/runtime/reproducibility",permalink:"/oasis-sdk/runtime/reproducibility",draft:!1,tags:[],version:"current",lastUpdatedAt:1656507485,formattedLastUpdatedAt:"6/29/2022",frontMatter:{},sidebar:"oasisSdk",previous:{title:"Modules",permalink:"/oasis-sdk/runtime/modules"}},p={},d=[{value:"Environment Setup",id:"environment-setup",level:2},{value:"Running the Image",id:"running-the-image",level:2},{value:"Building",id:"building",level:2},{value:"ELF",id:"elf",level:3},{value:"Intel SGX",id:"intel-sgx",level:3},{value:"Generating Bundles",id:"generating-bundles",level:2}],c={toc:d};function m(e){var t=e.components,n=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"reproducibility"},"Reproducibility"),(0,i.kt)("p",null,"If you wish to build paratime binaries yourself, you can use the\nenvironment provided as part of the SDK. This way you can also verify\nthat the binaries match the ones running on the network."),(0,i.kt)("p",null,"The steps below show how to build the test runtimes provided in the\n",(0,i.kt)("inlineCode",{parentName:"p"},"oasis-sdk")," sources; steps for other paratimes should be similar."),(0,i.kt)("h2",{id:"environment-setup"},"Environment Setup"),(0,i.kt)("p",null,"The build environment is provided as a Docker image containing all the\nnecessary tools. Refer to your system's documentation for pointers on\ninstalling software."),(0,i.kt)("p",null,"The runtime sources need to be mounted into the container so prepare a\ndirectory first, such as:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/oasisprotocol/oasis-sdk.git\n")),(0,i.kt)("h2",{id:"running-the-image"},"Running the Image"),(0,i.kt)("p",null,"The images are available in the ",(0,i.kt)("inlineCode",{parentName:"p"},"oasisprotocol/runtime-builder"),"\nrepository on Docker Hub and are tagged with the same version numbers as\nreleases of the SDK. To pull the image and run a container with it, run\nthe following:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"docker run -t -i -v /home/user/oasis-sdk:/src oasisprotocol/runtime-builder:main /bin/bash\n")),(0,i.kt)("p",null,"where:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"/home/user/oasis-sdk")," is the absolute path to the directory\ncontaining the SDK sources (or other paratimes - you likely do not need\nto download the SDK separately if you're building other paratimes), and"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"main")," is a release of the SDK - the documentation of the paratime\nyou're trying to build should mention the version required.")),(0,i.kt)("p",null,"This gives you a root shell in the container. Rust and Cargo are\ninstalled in ",(0,i.kt)("inlineCode",{parentName:"p"},"/cargo"),", Go in ",(0,i.kt)("inlineCode",{parentName:"p"},"/go"),", and the sources to your paratime are\navailable in ",(0,i.kt)("inlineCode",{parentName:"p"},"/src"),"."),(0,i.kt)("h2",{id:"building"},"Building"),(0,i.kt)("h3",{id:"elf"},"ELF"),(0,i.kt)("p",null,"Simply build the paratime in release mode using:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"cargo build --release\n")),(0,i.kt)("p",null,"The resulting binaries will be in ",(0,i.kt)("inlineCode",{parentName:"p"},"/src/target/release/"),"."),(0,i.kt)("h3",{id:"intel-sgx"},"Intel SGX"),(0,i.kt)("p",null,"Follow the normal build procedure for your paratime. For the testing\nruntimes in the SDK, e.g.:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"cd /src\ncargo build --release --target x86_64-fortanix-unknown-sgx\n")),(0,i.kt)("p",null,"After this step is complete, the binaries will be in\n",(0,i.kt)("inlineCode",{parentName:"p"},"/src/target/x86_64-fortanix-unknown-sgx/release/"),"."),(0,i.kt)("p",null,"To produce the sgxs format needed on the Oasis network, change directory\nto where a particular runtime's ",(0,i.kt)("inlineCode",{parentName:"p"},"Cargo.toml")," file is and run the\nfollowing command:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"cargo elf2sgxs --release\n")),(0,i.kt)("p",null,"It is necessary to change directories first because the tool does not\ncurrently support cargo workspaces."),(0,i.kt)("p",null,"The resulting binaries will have the ",(0,i.kt)("inlineCode",{parentName:"p"},".sgxs")," extension."),(0,i.kt)("h2",{id:"generating-bundles"},"Generating Bundles"),(0,i.kt)("p",null,"Oasis Core since version 22.0 distributes bundles in the Oasis Runtime Container\nformat which is basically a zip archive with some metadata attached. This makes\nit easier for node operators to configure paratimes. To ease creation of such\nbundles from built binaries and metadata, you can use the ",(0,i.kt)("inlineCode",{parentName:"p"},"orc")," tool provided by\nthe SDK."),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"You can install the ",(0,i.kt)("inlineCode",{parentName:"p"},"orc")," utility by running:"),(0,i.kt)("pre",{parentName:"div"},(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"go install github.com/oasisprotocol/oasis-sdk/tools/orc@latest\n")))),(0,i.kt)("p",null,"The same bundle can contain both ELF and Intel SGX artifacts. To create a bundle\nuse the following command:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"orc init path/to/elf-binary\n")),(0,i.kt)("p",null,"When including Intel SGX artifacts you may additionally specify:"),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"All bundles, even Intel SGX ones, are required to include an ELF binary of the\nparatime. This binary is used for client nodes that don't have SGX support."))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"orc init path/to/elf-binary --sgx-executable path/to/binary.sgxs --sgx-signature path/to/binary.sig\n")),(0,i.kt)("p",null,"You can omit the signature initially and add it later by using:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"orc sgx-set-sig bundle.orc path/to/binary.sig\n")))}m.isMDXComponent=!0}}]);